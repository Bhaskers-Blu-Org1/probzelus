open Cart_pole
open Pendulum
open Gym

let proba controller obs = action where
  rec action =
    if Infer_pf.sample (Distribution.bernoulli 0.5) then Right else Left

let proba model obs_gym = action where
  rec obs = simple_pendulum (obs_gym, (Right fby action))
  and action = controller (obs)
  and () = Infer_pf.factor (-10. *. (abs_float (obs.pole_angle)))
  and display = draw_obs_back obs

let node smart_main () = () where
  rec reset action = Infer_pf.plan 10 10 model obs  every true
  and obs, _, stop = cart_pole_gym true (Right fby action)
  and display = draw_obs_front obs
